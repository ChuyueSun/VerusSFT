{"conversations": [{"from": "system", "value": "You are an expert in Verus verification. Given code with a verification error, fix the code to make it verify successfully. Focus on adding or correcting specifications, invariants, or proof blocks."}, {"from": "human", "value": "The following Verus code has a verification error. Fix the code to make it verify.\n\nError message:\n```\nVerification failed after remove_requires\n```\n\nBroken code:\n```rust\n    pub proof fn un_acked_messages_extend(&self, src: AbstractEndPoint, dst: AbstractEndPoint, i: nat)\n        \n            i < self@.send_state[dst].un_acked.len(),\n            self.send_state.valid()\n        ensures\n            self@.un_acked_messages_for_dest_up_to(src, dst, i+1) ==\n            self@.un_acked_messages_for_dest_up_to(src, dst, i).insert(\n                Packet {\n                    src,\n                    dst,\n                    msg: self@.send_state[dst].un_acked[i as int]\n                }\n```\n\nProvide the fixed code:"}, {"from": "gpt", "value": "    pub proof fn un_acked_messages_extend(&self, src: AbstractEndPoint, dst: AbstractEndPoint, i: nat)\n        requires\n            self@.send_state.contains_key(dst),\n            i < self@.send_state[dst].un_acked.len(),\n            self.send_state.valid()\n        ensures\n            self@.un_acked_messages_for_dest_up_to(src, dst, i+1) ==\n            self@.un_acked_messages_for_dest_up_to(src, dst, i).insert(\n                Packet {\n                    src,\n                    dst,\n                    msg: self@.send_state[dst].un_acked[i as int]\n                }"}]}
{"conversations": [{"from": "system", "value": "You are an expert in Verus verification. Given code with a verification error, fix the code to make it verify successfully. Focus on adding or correcting specifications, invariants, or proof blocks."}, {"from": "human", "value": "The following Verus code has a verification error. Fix the code to make it verify.\n\nError message:\n```\nVerification failed after remove_ensures\n```\n\nBroken code:\n```rust\n\n    #[verifier(external_body)]\n    pub fn insert(&mut self, key: &EndPoint, value: V)\n       value)\n    {\n      let key_clone: EndPoint = key.clone_up_to_view();\n      self.m.insert(key_clone, value);\n    }\n```\n\nProvide the fixed code:"}, {"from": "gpt", "value": "\n    #[verifier(external_body)]\n    pub fn insert(&mut self, key: &EndPoint, value: V)\n      ensures self@ == old(self)@.insert(key@, value)\n    {\n      let key_clone: EndPoint = key.clone_up_to_view();\n      self.m.insert(key_clone, value);\n    }"}]}
{"conversations": [{"from": "system", "value": "You are an expert in Verus verification. Given code with a verification error, fix the code to make it verify successfully. Focus on adding or correcting specifications, invariants, or proof blocks."}, {"from": "human", "value": "The following Verus code has a verification error. Fix the code to make it verify.\n\nError message:\n```\nVerification failed after remove_ensures\n```\n\nBroken code:\n```rust\n\npub proof fn set_map_union_auto<A, B>()\n     f: spec_fn(A) -> B|\n        #[trigger] (s1 + s2).map(f) == s1.map(f) + s2.map(f)\n{\n    assert forall |s1: Set<A>, s2: Set<A>, f: spec_fn(A) -> B|\n        #[trigger] ((s1 + s2).map(f)) == s1.map(f) + s2.map(f) by {\n        set_map_union(s1, s2, f);\n    }\n}\n```\n\nProvide the fixed code:"}, {"from": "gpt", "value": "\npub proof fn set_map_union_auto<A, B>()\n    ensures forall |s1: Set<A>, s2: Set<A>, f: spec_fn(A) -> B|\n        #[trigger] (s1 + s2).map(f) == s1.map(f) + s2.map(f)\n{\n    assert forall |s1: Set<A>, s2: Set<A>, f: spec_fn(A) -> B|\n        #[trigger] ((s1 + s2).map(f)) == s1.map(f) + s2.map(f) by {\n        set_map_union(s1, s2, f);\n    }\n}"}]}
{"conversations": [{"from": "system", "value": "You are an expert in Verus verification. Given code with a verification error, fix the code to make it verify successfully. Focus on adding or correcting specifications, invariants, or proof blocks."}, {"from": "human", "value": "The following Verus code has a verification error. Fix the code to make it verify.\n\nError message:\n```\nVerification failed after remove_ensures\n```\n\nBroken code:\n```rust\n\npub proof fn lemma_map_seq_singleton_auto<A, B>()\n\n{\n}\n```\n\nProvide the fixed code:"}, {"from": "gpt", "value": "\npub proof fn lemma_map_seq_singleton_auto<A, B>()\nensures\n    forall |x: A, f: spec_fn(A) -> B| #[trigger] seq![x].map_values(f) =~= seq![f(x)],\n{\n}"}]}
{"conversations": [{"from": "system", "value": "You are an expert in Verus verification. Given code with a verification error, fix the code to make it verify successfully. Focus on adding or correcting specifications, invariants, or proof blocks."}, {"from": "human", "value": "The following Verus code has a verification error. Fix the code to make it verify.\n\nError message:\n```\nVerification failed after remove_ensures\n```\n\nBroken code:\n```rust\n    pub fn reset(&mut self)\n        requires\n            from_trusted_code()\n        ensures\n            self.state() is Receiving,\n            self.my_end_point() == old(self).my_end_point()\n    {\n        self.state = Ghost(State::Receiving);\n    }\n```\n\nProvide the fixed code:"}, {"from": "gpt", "value": "    pub fn reset(&mut self)\n        requires\n            from_trusted_code()\n        ensures\n            self.state() is Receiving,\n            self.my_end_point() == old(self).my_end_point()\n    {\n        self.state = Ghost(State::Receiving);\n    }"}]}
{"conversations": [{"from": "system", "value": "You are an expert in Verus verification. Given code with a verification error, fix the code to make it verify successfully. Focus on adding or correcting specifications, invariants, or proof blocks."}, {"from": "human", "value": "The following Verus code has a verification error. Fix the code to make it verify.\n\nError message:\n```\nVerification failed after remove_requires\n```\n\nBroken code:\n```rust\n    fn keys_in_index_range_agree(&self, lo: usize, hi: usize, v: &ID) -> (ret:(bool, bool))\n        requires \n            self.valid(),\n            0 <= lo <= hi < self.keys@.len(),\n        ensures \n            ret.0 == forall |i| #![auto] lo <= i <= hi ==> self@[self.keys@[i]]@ == v@,\n            !ret.0 ==> (ret.1 == (self@[self.keys@[hi as int]]@ != v@ && (forall |i| #![auto] lo <= i < hi ==> self@[self.keys@[i]]@ == v@))),\n    {\n        let (agree, almost) = self.values_agree(lo, hi, v);\n        proof {\n            if agree {\n            } else {\n                assert(!forall |i| #![auto] lo <= i <= hi ==> self.vals@[i]@ == v@);\n                let i = choose |i| #![auto] !(lo <= i <= hi ==> self.vals@.index(i)@ == v@);\n                assert(self.vals@.index(i)@ != v@);\n                assert(self@[self.keys@[i]]@ == self.vals@.index(i)@);\n                if almost {\n                } else {\n                    assert(!(self.vals@[hi as int]@ != v@ && forall |i| #![auto] lo <= i < hi ==> self.vals@[i]@ == v@));\n                    if self.vals@[hi as int]@ == v@ {\n                    } else {\n                        let j = choose |j| #![auto] lo <= j < hi && self.vals@[j]@ != v@;\n                        assert(self@[self.keys@[j]]@ != v@);\n                    }\n                }\n            }\n        }\n        (agree, almost)\n    }\n```\n\nProvide the fixed code:"}, {"from": "gpt", "value": "    fn keys_in_index_range_agree(&self, lo: usize, hi: usize, v: &ID) -> (ret:(bool, bool))\n        requires \n            self.valid(),\n            0 <= lo <= hi < self.keys@.len(),\n        ensures \n            ret.0 == forall |i| #![auto] lo <= i <= hi ==> self@[self.keys@[i]]@ == v@,\n            !ret.0 ==> (ret.1 == (self@[self.keys@[hi as int]]@ != v@ && (forall |i| #![auto] lo <= i < hi ==> self@[self.keys@[i]]@ == v@))),\n    {\n        let (agree, almost) = self.values_agree(lo, hi, v);\n        proof {\n            if agree {\n            } else {\n                assert(!forall |i| #![auto] lo <= i <= hi ==> self.vals@[i]@ == v@);\n                let i = choose |i| #![auto] !(lo <= i <= hi ==> self.vals@.index(i)@ == v@);\n                assert(self.vals@.index(i)@ != v@);\n                assert(self@[self.keys@[i]]@ == self.vals@.index(i)@);\n                if almost {\n                } else {\n                    assert(!(self.vals@[hi as int]@ != v@ && forall |i| #![auto] lo <= i < hi ==> self.vals@[i]@ == v@));\n                    if self.vals@[hi as int]@ == v@ {\n                    } else {\n                        let j = choose |j| #![auto] lo <= j < hi && self.vals@[j]@ != v@;\n                        assert(self@[self.keys@[j]]@ != v@);\n                    }\n                }\n            }\n        }\n        (agree, almost)\n    }"}]}
{"conversations": [{"from": "system", "value": "You are an expert in Verus verification. Given code with a verification error, fix the code to make it verify successfully. Focus on adding or correcting specifications, invariants, or proof blocks."}, {"from": "human", "value": "The following Verus code has a verification error. Fix the code to make it verify.\n\nError message:\n```\nVerification failed after remove_ensures\n```\n\nBroken code:\n```rust\n\npub proof fn lemma_flatten_sets_union_auto<A>()\n     sets2: Set<Set<A>>|\n        #[trigger] flatten_sets(sets1.union(sets2)) == flatten_sets(sets1).union(flatten_sets(sets2)) by {\n        lemma_flatten_sets_union(sets1, sets2);\n    }\n}\n```\n\nProvide the fixed code:"}, {"from": "gpt", "value": "\npub proof fn lemma_flatten_sets_union_auto<A>()\n    ensures forall |sets1: Set<Set<A>>, sets2: Set<Set<A>>|\n        #[trigger] flatten_sets(sets1.union(sets2)) == flatten_sets(sets1).union(flatten_sets(sets2))\n{\n    assert forall |sets1: Set<Set<A>>, sets2: Set<Set<A>>|\n        #[trigger] flatten_sets(sets1.union(sets2)) == flatten_sets(sets1).union(flatten_sets(sets2)) by {\n        lemma_flatten_sets_union(sets1, sets2);\n    }\n}"}]}
{"conversations": [{"from": "system", "value": "You are an expert in Verus verification. Given code with a verification error, fix the code to make it verify successfully. Focus on adding or correcting specifications, invariants, or proof blocks."}, {"from": "human", "value": "The following Verus code has a verification error. Fix the code to make it verify.\n\nError message:\n```\nVerification failed after remove_requires\n```\n\nBroken code:\n```rust\n    #[verifier::rlimit(15)]\n    pub fn send_single_cmessage(&mut self, m: &CMessage, dst: &EndPoint) -> (sm: Option<CSingleMessage>)\n        requires\n            old(self).valid(),\n            old(self).abstractable(),\n            m.abstractable(),\n            m.message_marshallable(),\n            m.is_marshalable(),\n            dst@.valid_physical_address(),\n        ensures\n            self.valid(),\n            match sm {\n                Some(sm) => {\n                    &&& sm.abstractable()\n                    &&& sm is Message\n                    &&& sm.arrow_Message_dst()@ == dst@\n                    &&& SingleDelivery::send_single_message(old(self)@, self@, m@, dst@, Some(sm@), AbstractParameters::static_params())\n                    &&& sm.is_marshalable()\n                },\n                None =>\n                    SingleDelivery::send_single_message(old(self)@, self@, m@, dst@, None, AbstractParameters::static_params()),\n            }\n```\n\nProvide the fixed code:"}, {"from": "gpt", "value": "    #[verifier::rlimit(15)]\n    pub fn send_single_cmessage(&mut self, m: &CMessage, dst: &EndPoint) -> (sm: Option<CSingleMessage>)\n        requires\n            old(self).valid(),\n            old(self).abstractable(),\n            m.abstractable(),\n            m.message_marshallable(),\n            m.is_marshalable(),\n            dst@.valid_physical_address(),\n        ensures\n            self.valid(),\n            match sm {\n                Some(sm) => {\n                    &&& sm.abstractable()\n                    &&& sm is Message\n                    &&& sm.arrow_Message_dst()@ == dst@\n                    &&& SingleDelivery::send_single_message(old(self)@, self@, m@, dst@, Some(sm@), AbstractParameters::static_params())\n                    &&& sm.is_marshalable()\n                },\n                None =>\n                    SingleDelivery::send_single_message(old(self)@, self@, m@, dst@, None, AbstractParameters::static_params()),\n            }"}]}
{"conversations": [{"from": "system", "value": "You are an expert in Verus verification. Given code with a verification error, fix the code to make it verify successfully. Focus on adding or correcting specifications, invariants, or proof blocks."}, {"from": "human", "value": "The following Verus code has a verification error. Fix the code to make it verify.\n\nError message:\n```\nVerification failed after remove_requires\n```\n\nBroken code:\n```rust\n\n    proof fn almost_all_keys_agree(&self, lo: usize, hi: usize, id: &ID)\n        requires\n            self.valid(),\n            0 <= lo <= hi < self.lows.keys@.len(),\n            forall |i| #![auto] lo <= i < hi ==> self.lows@[self.lows.keys@[i]]@ == id@,\n        ensures\n            self.range_consistent(&KeyIterator::new_spec(self.lows.keys@[lo as int]), &KeyIterator::new_spec(self.lows.keys@[hi as int]), id),\n        decreases hi - lo,\n    {\n        let lo_k = self.lows.keys@[lo as int];\n        let hi_k = self.lows.keys@[hi as int];\n        let lo_ki = KeyIterator::new_spec(lo_k);\n        let hi_ki = KeyIterator::new_spec(hi_k);\n        if lo_ki.geq_spec(hi_ki) {\n            self.empty_key_range_is_consistent(&lo_ki, &hi_ki, id);\n        } else {\n            assert(lo_ki.lt_spec(hi_ki) && lo < hi) by {\n                K::cmp_properties();\n            }\n            let lo_next = (lo + 1) as usize;\n            let lo_next_k = self.lows.keys@[lo_next as int];\n            let lo_next_ki = KeyIterator::new_spec(lo_next_k);\n            assert(self.lows.gap(lo_ki, lo_next_ki)) by {\n                K::cmp_properties();\n            }\n            assert(self.range_consistent(&lo_ki, &lo_next_ki, id));\n            self.almost_all_keys_agree(lo_next, hi, id);\n            self.extend_range_consistent(&lo_ki, &lo_next_ki, &hi_ki, id);\n        }\n\n    }\n```\n\nProvide the fixed code:"}, {"from": "gpt", "value": "\n    proof fn almost_all_keys_agree(&self, lo: usize, hi: usize, id: &ID)\n        requires\n            self.valid(),\n            0 <= lo <= hi < self.lows.keys@.len(),\n            forall |i| #![auto] lo <= i < hi ==> self.lows@[self.lows.keys@[i]]@ == id@,\n        ensures\n            self.range_consistent(&KeyIterator::new_spec(self.lows.keys@[lo as int]), &KeyIterator::new_spec(self.lows.keys@[hi as int]), id),\n        decreases hi - lo,\n    {\n        let lo_k = self.lows.keys@[lo as int];\n        let hi_k = self.lows.keys@[hi as int];\n        let lo_ki = KeyIterator::new_spec(lo_k);\n        let hi_ki = KeyIterator::new_spec(hi_k);\n        if lo_ki.geq_spec(hi_ki) {\n            self.empty_key_range_is_consistent(&lo_ki, &hi_ki, id);\n        } else {\n            assert(lo_ki.lt_spec(hi_ki) && lo < hi) by {\n                K::cmp_properties();\n            }\n            let lo_next = (lo + 1) as usize;\n            let lo_next_k = self.lows.keys@[lo_next as int];\n            let lo_next_ki = KeyIterator::new_spec(lo_next_k);\n            assert(self.lows.gap(lo_ki, lo_next_ki)) by {\n                K::cmp_properties();\n            }\n            assert(self.range_consistent(&lo_ki, &lo_next_ki, id));\n            self.almost_all_keys_agree(lo_next, hi, id);\n            self.extend_range_consistent(&lo_ki, &lo_next_ki, &hi_ki, id);\n        }\n\n    }"}]}
{"conversations": [{"from": "system", "value": "You are an expert in Verus verification. Given code with a verification error, fix the code to make it verify successfully. Focus on adding or correcting specifications, invariants, or proof blocks."}, {"from": "human", "value": "The following Verus code has a verification error. Fix the code to make it verify.\n\nError message:\n```\nVerification failed after remove_ensures\n```\n\nBroken code:\n```rust\n\n    pub fn get_my_end_point(&self) -> (ep: EndPoint)\n        \n```\n\nProvide the fixed code:"}, {"from": "gpt", "value": "\n    pub fn get_my_end_point(&self) -> (ep: EndPoint)\n        ensures\n            ep@ == self.my_end_point()\n    {\n        self.end_point.clone_up_to_view()\n    }"}]}
{"conversations": [{"from": "system", "value": "You are an expert in Verus verification. Given code with a verification error, fix the code to make it verify successfully. Focus on adding or correcting specifications, invariants, or proof blocks."}, {"from": "human", "value": "The following Verus code has a verification error. Fix the code to make it verify.\n\nError message:\n```\nVerification failed after remove_ensures\n```\n\nBroken code:\n```rust\n\n\npub proof fn lemma_seq_push_to_set<A>(s: Seq<A>, x: A)\n     elem => {\n        if elem == x {\n            assert(s.push(x)[s.len() as int] == x);\n            assert(s.push(x).contains(x))\n        } else {\n            if s.to_set().insert(x).contains(elem) {\n                assert(s.to_set().contains(elem));\n                let i = choose |i: int| 0 <= i < s.len() && s[i] == elem;\n                assert(s.push(x)[i] == elem);\n            }\n        }\n    });\n}\n```\n\nProvide the fixed code:"}, {"from": "gpt", "value": "\n\npub proof fn lemma_seq_push_to_set<A>(s: Seq<A>, x: A)\n    ensures s.push(x).to_set() == s.to_set().insert(x)\n{\n    assert_sets_equal!(s.push(x).to_set() == s.to_set().insert(x), elem => {\n        if elem == x {\n            assert(s.push(x)[s.len() as int] == x);\n            assert(s.push(x).contains(x))\n        } else {\n            if s.to_set().insert(x).contains(elem) {\n                assert(s.to_set().contains(elem));\n                let i = choose |i: int| 0 <= i < s.len() && s[i] == elem;\n                assert(s.push(x)[i] == elem);\n            }\n        }\n    });\n}"}]}
{"conversations": [{"from": "system", "value": "You are an expert in Verus verification. Given code with a verification error, fix the code to make it verify successfully. Focus on adding or correcting specifications, invariants, or proof blocks."}, {"from": "human", "value": "The following Verus code has a verification error. Fix the code to make it verify.\n\nError message:\n```\nVerification failed after remove_ensures\n```\n\nBroken code:\n```rust\n\n    #[verifier(when_used_as_spec(end_spec))]\n    pub fn end() -> (s: Self)\n        \n```\n\nProvide the fixed code:"}, {"from": "gpt", "value": "\n    #[verifier(when_used_as_spec(end_spec))]\n    pub fn end() -> (s: Self)\n        ensures s.k is None\n    {\n        KeyIterator { k: None }\n    }"}]}
{"conversations": [{"from": "system", "value": "You are an expert in Verus verification. Given code with a verification error, fix the code to make it verify successfully. Focus on adding or correcting specifications, invariants, or proof blocks."}, {"from": "human", "value": "The following Verus code has a verification error. Fix the code to make it verify.\n\nError message:\n```\nVerification failed after remove_ensures\n```\n\nBroken code:\n```rust\n    #[verifier::rlimit(15)]\n    pub fn send_single_cmessage(&mut self, m: &CMessage, dst: &EndPoint) -> (sm: Option<CSingleMessage>)\n        requires\n            old(self).valid(),\n            old(self).abstractable(),\n            m.abstractable(),\n            m.message_marshallable(),\n            m.is_marshalable(),\n            dst@.valid_physical_address(),\n        ensures\n            self.valid(),\n            match sm {\n                Some(sm) => {\n                    &&& sm.abstractable()\n                    &&& sm is Message\n                    &&& sm.arrow_Message_dst()@ == dst@\n                    &&& SingleDelivery::send_single_message(old(self)@, self@, m@, dst@, Some(sm@), AbstractParameters::static_params())\n                    &&& sm.is_marshalable()\n                },\n                None =>\n                    SingleDelivery::send_single_message(old(self)@, self@, m@, dst@, None, AbstractParameters::static_params()),\n            }\n```\n\nProvide the fixed code:"}, {"from": "gpt", "value": "    #[verifier::rlimit(15)]\n    pub fn send_single_cmessage(&mut self, m: &CMessage, dst: &EndPoint) -> (sm: Option<CSingleMessage>)\n        requires\n            old(self).valid(),\n            old(self).abstractable(),\n            m.abstractable(),\n            m.message_marshallable(),\n            m.is_marshalable(),\n            dst@.valid_physical_address(),\n        ensures\n            self.valid(),\n            match sm {\n                Some(sm) => {\n                    &&& sm.abstractable()\n                    &&& sm is Message\n                    &&& sm.arrow_Message_dst()@ == dst@\n                    &&& SingleDelivery::send_single_message(old(self)@, self@, m@, dst@, Some(sm@), AbstractParameters::static_params())\n                    &&& sm.is_marshalable()\n                },\n                None =>\n                    SingleDelivery::send_single_message(old(self)@, self@, m@, dst@, None, AbstractParameters::static_params()),\n            }"}]}
{"conversations": [{"from": "system", "value": "You are an expert in Verus verification. Given code with a verification error, fix the code to make it verify successfully. Focus on adding or correcting specifications, invariants, or proof blocks."}, {"from": "human", "value": "The following Verus code has a verification error. Fix the code to make it verify.\n\nError message:\n```\nVerification failed after remove_requires\n```\n\nBroken code:\n```rust\n    fn erase(&mut self, lo: &KeyIterator<K>, hi: &KeyIterator<K>)\n        requires\n            old(self).valid(),\n        ensures\n            self.valid(),\n            forall |k| {\n                let ki = KeyIterator::new_spec(k);\n                (if ki.geq_spec(*lo) && ki.lt_spec(*hi) {\n                    !(#[trigger] self@.contains_key(k))\n                } else {\n                    (old(self)@.contains_key(k) ==>\n                         self@.contains_key(k) && self@[k] == old(self)@[k])\n                    && (self@.contains_key(k) ==> old(self)@.contains_key(k))\n                })}\n```\n\nProvide the fixed code:"}, {"from": "gpt", "value": "    fn erase(&mut self, lo: &KeyIterator<K>, hi: &KeyIterator<K>)\n        requires\n            old(self).valid(),\n        ensures\n            self.valid(),\n            forall |k| {\n                let ki = KeyIterator::new_spec(k);\n                (if ki.geq_spec(*lo) && ki.lt_spec(*hi) {\n                    !(#[trigger] self@.contains_key(k))\n                } else {\n                    (old(self)@.contains_key(k) ==>\n                         self@.contains_key(k) && self@[k] == old(self)@[k])\n                    && (self@.contains_key(k) ==> old(self)@.contains_key(k))\n                })}"}]}
{"conversations": [{"from": "system", "value": "You are an expert in Verus verification. Given code with a verification error, fix the code to make it verify successfully. Focus on adding or correcting specifications, invariants, or proof blocks."}, {"from": "human", "value": "The following Verus code has a verification error. Fix the code to make it verify.\n\nError message:\n```\nVerification failed after remove_ensures\n```\n\nBroken code:\n```rust\n    fn values_agree(&self, lo: usize, hi: usize, v: &ID) -> (ret:(bool, bool))\n        requires \n            self.valid(),\n            0 <= lo <= hi < self.keys@.len(),\n        \n            !ret.0 ==> (ret.1 == (self.vals@[hi as int]@ != v@ && forall |i| #![auto] lo <= i < hi ==> self.vals@[i]@ == v@)),\n    {\n        let mut i = lo;\n        while i <= hi\n            invariant \n                lo <= i,\n                self.keys@.len() <= usize::MAX,\n                hi < self.keys@.len() as usize == self.vals@.len(),\n                forall |j| #![auto] lo <= j < i ==> self.vals@[j]@ == v@,\n            decreases\n                self.keys@.len() - i\n        {\n            let eq = do_end_points_match(&self.vals[i], v);\n            if  !eq {\n                if i == hi {\n                    return (false, true);\n                } else {\n                    return (false, false);\n                }\n            } else {\n                proof {\n                    //K::cmp_properties();\n                }\n            }\n            i = i + 1;\n        }\n        (true, true)\n    }\n```\n\nProvide the fixed code:"}, {"from": "gpt", "value": "    fn values_agree(&self, lo: usize, hi: usize, v: &ID) -> (ret:(bool, bool))\n        requires \n            self.valid(),\n            0 <= lo <= hi < self.keys@.len(),\n        ensures \n            ret.0 == forall |i| #![auto] lo <= i <= hi ==> self.vals@[i]@ == v@,\n            !ret.0 ==> (ret.1 == (self.vals@[hi as int]@ != v@ && forall |i| #![auto] lo <= i < hi ==> self.vals@[i]@ == v@)),\n    {\n        let mut i = lo;\n        while i <= hi\n            invariant \n                lo <= i,\n                self.keys@.len() <= usize::MAX,\n                hi < self.keys@.len() as usize == self.vals@.len(),\n                forall |j| #![auto] lo <= j < i ==> self.vals@[j]@ == v@,\n            decreases\n                self.keys@.len() - i\n        {\n            let eq = do_end_points_match(&self.vals[i], v);\n            if  !eq {\n                if i == hi {\n                    return (false, true);\n                } else {\n                    return (false, false);\n                }\n            } else {\n                proof {\n                    //K::cmp_properties();\n                }\n            }\n            i = i + 1;\n        }\n        (true, true)\n    }"}]}
{"conversations": [{"from": "system", "value": "You are an expert in Verus verification. Given code with a verification error, fix the code to make it verify successfully. Focus on adding or correcting specifications, invariants, or proof blocks."}, {"from": "human", "value": "The following Verus code has a verification error. Fix the code to make it verify.\n\nError message:\n```\nVerification failed after remove_ensures\n```\n\nBroken code:\n```rust\n    pub fn init_impl(netc: &NetClient, args: &Args) -> (rc: Option<Self>)\n    requires\n        netc.valid()\n        // IronFleet also gives us netc.IsOpen(), but it seems to be rotted, so we're ignoring it\n     rc),\n    {\n        Self::real_init_impl(netc, args)\n    }\n```\n\nProvide the fixed code:"}, {"from": "gpt", "value": "    pub fn init_impl(netc: &NetClient, args: &Args) -> (rc: Option<Self>)\n    requires\n        netc.valid()\n        // IronFleet also gives us netc.IsOpen(), but it seems to be rotted, so we're ignoring it\n    ensures\n        Self::init_ensures(netc, *args, rc),\n    {\n        Self::real_init_impl(netc, args)\n    }"}]}
{"conversations": [{"from": "system", "value": "You are an expert in Verus verification. Given code with a verification error, fix the code to make it verify successfully. Focus on adding or correcting specifications, invariants, or proof blocks."}, {"from": "human", "value": "The following Verus code has a verification error. Fix the code to make it verify.\n\nError message:\n```\nVerification failed after remove_requires\n```\n\nBroken code:\n```rust\n\n    proof fn empty_key_range_is_consistent(&self, lo: &KeyIterator<K>, hi: &KeyIterator<K>, id: &ID)\n        requires\n            lo.geq_spec(*hi),\n        ensures \n            self.range_consistent(lo, hi, id),\n    {\n        K::cmp_properties();\n    }\n```\n\nProvide the fixed code:"}, {"from": "gpt", "value": "\n    proof fn empty_key_range_is_consistent(&self, lo: &KeyIterator<K>, hi: &KeyIterator<K>, id: &ID)\n        requires\n            lo.geq_spec(*hi),\n        ensures \n            self.range_consistent(lo, hi, id),\n    {\n        K::cmp_properties();\n    }"}]}
{"conversations": [{"from": "system", "value": "You are an expert in Verus verification. Given code with a verification error, fix the code to make it verify successfully. Focus on adding or correcting specifications, invariants, or proof blocks."}, {"from": "human", "value": "The following Verus code has a verification error. Fix the code to make it verify.\n\nError message:\n```\nVerification failed after remove_ensures\n```\n\nBroken code:\n```rust\n    fn erase(&mut self, lo: &KeyIterator<K>, hi: &KeyIterator<K>)\n        requires\n            old(self).valid(),\n        ensures\n            self.valid(),\n            forall |k| {\n                let ki = KeyIterator::new_spec(k);\n                (if ki.geq_spec(*lo) && ki.lt_spec(*hi) {\n                    !(#[trigger] self@.contains_key(k))\n                } else {\n                    (old(self)@.contains_key(k) ==>\n                         self@.contains_key(k) && self@[k] == old(self)@[k])\n                    && (self@.contains_key(k) ==> old(self)@.contains_key(k))\n                })}\n```\n\nProvide the fixed code:"}, {"from": "gpt", "value": "    fn erase(&mut self, lo: &KeyIterator<K>, hi: &KeyIterator<K>)\n        requires\n            old(self).valid(),\n        ensures\n            self.valid(),\n            forall |k| {\n                let ki = KeyIterator::new_spec(k);\n                (if ki.geq_spec(*lo) && ki.lt_spec(*hi) {\n                    !(#[trigger] self@.contains_key(k))\n                } else {\n                    (old(self)@.contains_key(k) ==>\n                         self@.contains_key(k) && self@[k] == old(self)@[k])\n                    && (self@.contains_key(k) ==> old(self)@.contains_key(k))\n                })}"}]}
{"conversations": [{"from": "system", "value": "You are an expert in Verus verification. Given code with a verification error, fix the code to make it verify successfully. Focus on adding or correcting specifications, invariants, or proof blocks."}, {"from": "human", "value": "The following Verus code has a verification error. Fix the code to make it verify.\n\nError message:\n```\nVerification failed after remove_ensures\n```\n\nBroken code:\n```rust\n    #[verifier(external_body)]\n    #[verifier(when_used_as_spec(spec_from_vec))]\n    pub fn from_vec(v: Vec<CKeyKV>) -> (res: Self)\n       v } in v {\n            res.insert(k, v);\n        }\n        res\n    }\n```\n\nProvide the fixed code:"}, {"from": "gpt", "value": "    #[verifier(external_body)]\n    #[verifier(when_used_as_spec(spec_from_vec))]\n    pub fn from_vec(v: Vec<CKeyKV>) -> (res: Self)\n      ensures res == Self::spec_from_vec(v)\n    {\n        let mut res = CKeyHashMap::new();\n        for CKeyKV { k, v } in v {\n            res.insert(k, v);\n        }\n        res\n    }"}]}
{"conversations": [{"from": "system", "value": "You are an expert in Verus verification. Given code with a verification error, fix the code to make it verify successfully. Focus on adding or correcting specifications, invariants, or proof blocks."}, {"from": "human", "value": "The following Verus code has a verification error. Fix the code to make it verify.\n\nError message:\n```\nVerification failed after remove_ensures\n```\n\nBroken code:\n```rust\n\n    pub fn contains_exec(&self, k: &K) -> (b: bool)\n    \n    {\n        let ki = KeyIterator { k: Some(k.clone()) };\n        !ki.lt(&self.lo) && ki.lt(&self.hi)\n    }\n```\n\nProvide the fixed code:"}, {"from": "gpt", "value": "\n    pub fn contains_exec(&self, k: &K) -> (b: bool)\n    ensures\n        b == self.contains(*k),\n    {\n        let ki = KeyIterator { k: Some(k.clone()) };\n        !ki.lt(&self.lo) && ki.lt(&self.hi)\n    }"}]}
{"conversations": [{"from": "system", "value": "You are an expert in Verus verification. Given code with a verification error, fix the code to make it verify successfully. Focus on adding or correcting specifications, invariants, or proof blocks."}, {"from": "human", "value": "The following Verus code has a verification error. Fix the code to make it verify.\n\nError message:\n```\nVerification failed after remove_ensures\n```\n\nBroken code:\n```rust\n\n\npub proof fn lemma_subrange_subrange<A>(s: Seq<A>, start: int, midsize: int, endsize: int)\n  requires\n    0 <= start <= s.len(),\n    0 <= midsize <= endsize <= s.len() - start,\n   midsize) == s.subrange(start, start + midsize),\n{\n  assert(s.subrange(start, start + endsize).subrange(0, midsize) =~= s.subrange(start, start + midsize));\n}\n```\n\nProvide the fixed code:"}, {"from": "gpt", "value": "\n\npub proof fn lemma_subrange_subrange<A>(s: Seq<A>, start: int, midsize: int, endsize: int)\n  requires\n    0 <= start <= s.len(),\n    0 <= midsize <= endsize <= s.len() - start,\n  ensures\n    s.subrange(start, start + endsize).subrange(0, midsize) == s.subrange(start, start + midsize),\n{\n  assert(s.subrange(start, start + endsize).subrange(0, midsize) =~= s.subrange(start, start + midsize));\n}"}]}
{"conversations": [{"from": "system", "value": "You are an expert in Verus verification. Given code with a verification error, fix the code to make it verify successfully. Focus on adding or correcting specifications, invariants, or proof blocks."}, {"from": "human", "value": "The following Verus code has a verification error. Fix the code to make it verify.\n\nError message:\n```\nVerification failed after remove_ensures\n```\n\nBroken code:\n```rust\n\n\npub fn clone_arg(arg: &Arg) -> (out: Arg)\n\n```\n\nProvide the fixed code:"}, {"from": "gpt", "value": "\n\npub fn clone_arg(arg: &Arg) -> (out: Arg)\nensures\n    out@ == arg@\n{\n    clone_vec_u8(arg)\n}"}]}
{"conversations": [{"from": "system", "value": "You are an expert in Verus verification. Given code with a verification error, fix the code to make it verify successfully. Focus on adding or correcting specifications, invariants, or proof blocks."}, {"from": "human", "value": "The following Verus code has a verification error. Fix the code to make it verify.\n\nError message:\n```\nVerification failed after remove_ensures\n```\n\nBroken code:\n```rust\n\n  pub fn clone_up_to_view(&self) -> (c: Self)\n   dst, m} => {\n              CSingleMessage::Message{seqno: *seqno, dst: dst.clone_up_to_view(), m: m.clone_up_to_view() }\n          },\n          CSingleMessage::Ack{ack_seqno} => { CSingleMessage::Ack{ ack_seqno: *ack_seqno } },\n          CSingleMessage::InvalidMessage{} => { CSingleMessage::InvalidMessage{} }\n      }\n  }\n```\n\nProvide the fixed code:"}, {"from": "gpt", "value": "\n  pub fn clone_up_to_view(&self) -> (c: Self)\n  ensures\n    c@ == self@\n  {\n      match self {\n          CSingleMessage::Message{seqno, dst, m} => {\n              CSingleMessage::Message{seqno: *seqno, dst: dst.clone_up_to_view(), m: m.clone_up_to_view() }\n          },\n          CSingleMessage::Ack{ack_seqno} => { CSingleMessage::Ack{ ack_seqno: *ack_seqno } },\n          CSingleMessage::InvalidMessage{} => { CSingleMessage::InvalidMessage{} }\n      }\n  }"}]}
{"conversations": [{"from": "system", "value": "You are an expert in Verus verification. Given code with a verification error, fix the code to make it verify successfully. Focus on adding or correcting specifications, invariants, or proof blocks."}, {"from": "human", "value": "The following Verus code has a verification error. Fix the code to make it verify.\n\nError message:\n```\nVerification failed after remove_ensures\n```\n\nBroken code:\n```rust\n\npub proof fn map_set_finite_auto<A, B>()\n\n{\n    assert forall |s: Set<A>, f: spec_fn(A) -> B| s.finite() implies #[trigger] s.map(f).finite() by {\n        map_finite(s, f);\n    }\n}\n```\n\nProvide the fixed code:"}, {"from": "gpt", "value": "\npub proof fn map_set_finite_auto<A, B>()\nensures\n    forall |s: Set<A>, f: spec_fn(A) -> B| s.finite() ==> #[trigger] (s.map(f).finite()),\n{\n    assert forall |s: Set<A>, f: spec_fn(A) -> B| s.finite() implies #[trigger] s.map(f).finite() by {\n        map_finite(s, f);\n    }\n}"}]}
{"conversations": [{"from": "system", "value": "You are an expert in Verus verification. Given code with a verification error, fix the code to make it verify successfully. Focus on adding or correcting specifications, invariants, or proof blocks."}, {"from": "human", "value": "The following Verus code has a verification error. Fix the code to make it verify.\n\nError message:\n```\nVerification failed after remove_ensures\n```\n\nBroken code:\n```rust\n\n    #[verifier(when_used_as_spec(is_end_spec))]\n    pub fn is_end(&self) -> (b: bool)\n         None)\n    }\n```\n\nProvide the fixed code:"}, {"from": "gpt", "value": "\n    #[verifier(when_used_as_spec(is_end_spec))]\n    pub fn is_end(&self) -> (b: bool)\n        ensures b == self.is_end_spec()\n    {\n        matches!(self.k, None)\n    }"}]}
{"conversations": [{"from": "system", "value": "You are an expert in Verus verification. Given code with a verification error, fix the code to make it verify successfully. Focus on adding or correcting specifications, invariants, or proof blocks."}, {"from": "human", "value": "The following Verus code has a verification error. Fix the code to make it verify.\n\nError message:\n```\nVerification failed after remove_ensures\n```\n\nBroken code:\n```rust\n    fn index(&self, i: usize) -> (k: K)\n        requires i < self@.len(),\n        \n```\n\nProvide the fixed code:"}, {"from": "gpt", "value": "    fn index(&self, i: usize) -> (k: K)\n        requires i < self@.len(),\n        ensures k == self@[i as int]\n    {\n        (self.v[i]).clone()\n    }"}]}
